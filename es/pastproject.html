<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--  -->
    <!--    Document Title-->
    <!-- =============================================-->
    <title>
      Caret Capital | Gestión de capital activa accesible, inteligente y de
      confianza
    </title>
    <!--  -->
    <!--    Favicons-->
    <!--    =============================================-->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../assets/images/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../assets/images/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../assets/images/favicons/favicon-16x16.png"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="../assets/images/favicons/favicon.ico"
    />
    <link rel="manifest" href="../assets/images/favicons/site.webmanifest" />

    <meta name="theme-color" content="#ffffff" />
    <!--  -->
    <!--    Stylesheets-->
    <!--    =============================================-->
    <!-- Default stylesheets-->
    <link
      href="../assets/lib/bootstrap/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Template specific stylesheets-->
    <link href="../assets/lib/loaders.css/loaders.min.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700|Open+Sans:300,400,600,700,800"
      rel="stylesheet"
    />
    <link href="../assets/lib/iconsmind/iconsmind.css" rel="stylesheet" />
    <link
      href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/lib/hamburgers/dist/hamburgers.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/lib/font-awesome/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/lib/owl.carousel/dist/assets/owl.carousel.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/lib/owl.carousel/dist/assets/owl.theme.default.min.css"
      rel="stylesheet"
    />
    <link href="../assets/lib/remodal/dist/remodal.css" rel="stylesheet" />
    <link
      href="../assets/lib/remodal/dist/remodal-default-theme.css"
      rel="stylesheet"
    />
    <link href="../assets/lib/flexslider/flexslider.css" rel="stylesheet" />
    <link
      href="../assets/lib/lightbox2/dist/css/lightbox.css"
      rel="stylesheet"
    />
    <!-- Main stylesheet and color file-->
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/custom.css" rel="stylesheet" />
  </head>
  <body data-spy="scroll" data-target=".inner-link" data-offset="60">
    <main>
      <div class="loading" id="preloader">
        <div
          class="loader h-100 d-flex align-items-center justify-content-center"
        >
          <div class="line-scale">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </div>
      <div
        class="znav-white znav-container sticky-top navbar-elixir"
        id="znav-container"
      >
        <div class="container">
          <nav class="navbar navbar-expand-lg">
            <a
              class="navbar-brand overflow-hidden pr-3 pb-2"
              href="../index.html"
              ><img
                src="../assets/images/logo/logo4.png"
                alt=""
                style="width: 40px"
                id="logo-icon1" />
              <img
                src="../assets/images/logo/logo7.png"
                alt=""
                style="width: 150px"
                id="logo-icon2"
            /></a>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarNavDropdown"
              aria-controls="navbarNavDropdown"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <div class="hamburger hamburger--emphatic">
                <div class="hamburger-box">
                  <div class="hamburger-inner"></div>
                </div>
              </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
              <ul class="navbar-nav fs-0 fw-700">
                <li>
                  <a class="d-block" href="about.html">NOSOTROS</a>
                </li>
                <li>
                  <a class="d-block" href="services.html">SERVICIOS</a>
                </li>
                <li>
                  <a href="JavaScript:void(0)">PROYECTOS</a>
                  <ul class="dropdown fs--1">
                    <li><a href="current.html">PROYECTOS EN CURSO</a></li>
                    <li><a href="past.html">PROYECTOS PASADOS</a></li>
                  </ul>
                </li>
                <li>
                  <a class="d-block" href="contact.html">CONTACTO</a>
                </li>
              </ul>
              <ul class="navbar-nav ml-lg-auto">
                <li>
                  <a
                    class="btn btn-outline-primary btn-sm border-2x fw-700"
                    style="font-size: 0.85rem"
                    href="login.html"
                    >CARET ECOSYSTEM</a
                  >
                </li>
              </ul>
            </div>
          </nav>
        </div>
      </div>

      <!-- Hero Section -->
      <section>
        <div>
          <div
            class="background-holder overlay"
            style="
              background-image: url(../assets/images/images/torres.jpg);
              background-position: center bottom;
            "
          ></div>
          <!--/.background-holder-->
          <div class="container">
            <div class="row pt-6" data-inertia='{"weight":1.5}'>
              <div
                class="col-md-8 px-md-0 color-white"
                data-zanim-timeline="{}"
                data-zanim-trigger="scroll"
              >
                <div class="overflow-hidden">
                  <h1
                    class="color-white fs-4 fs-md-5 mb-0 zopacity"
                    data-zanim='{"delay":0}'
                    id="project-title"
                  >
                    Cargando proyecto...
                  </h1>
                  <div
                    class="nav zopacity"
                    aria-label="breadcrumb"
                    role="navigation"
                    data-zanim='{"delay":0.1}'
                  >
                    <ol class="breadcrumb fs-1 pl-0 fw-700">
                      <li class="breadcrumb-item">
                        <a class="color-white" href="../index.html">Inicio</a>
                      </li>
                      <li class="breadcrumb-item">
                        <a class="color-white" href="current.html"
                          >Proyectos en Curso</a
                        >
                      </li>
                      <li
                        class="breadcrumb-item active"
                        aria-current="page"
                        id="breadcrumb-project-name"
                      >
                        Cargando...
                      </li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!--/.row-->
        </div>
        <!--/.container-->
      </section>

      <!-- Project Details Section -->
      <section class="project-section background-11">
        <div class="container">
          <!-- Indicador de carga -->
          <div id="loading-indicator" class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Cargando proyecto...</span>
            </div>
            <p class="mt-3">Cargando detalles del proyecto...</p>
          </div>

          <!-- Contenido del proyecto -->
          <div
            id="project-content"
            class="project-container"
            style="display: none"
          >
            <!-- Carousel -->
            <div
              id="project-carousel"
              class="carousel slide project-carousel"
              data-ride="carousel"
            >
              <div class="carousel-inner" id="carousel-items">
                <!-- Las imágenes se cargarán aquí -->
              </div>

              <!-- Indicadores del carousel -->
              <ol class="carousel-indicators" id="carousel-indicators">
                <!-- Los indicadores se generarán dinámicamente -->
              </ol>

              <!-- Controles del carousel -->
              <button
                class="carousel-control-prev"
                type="button"
                data-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="sr-only">Anterior</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="sr-only">Siguiente</span>
              </button>
            </div>

            <!-- Detalles del proyecto -->
            <div class="project-details">
              <!-- Cabecera con título y estado -->
              <div class="project-header">
                <h2 class="project-title" id="detail-project-name">
                  Detalles del Proyecto
                </h2>
                <span class="status-badge" id="project-status">Estado</span>
              </div>

              <!-- Grid de detalles básicos -->
              <div class="project-details-grid">
                <!-- Ubicación -->
                <div class="project-detail-item">
                  <div class="project-detail-label">
                    <i class="fa fa-map-marker"></i>Ubicación
                  </div>
                  <div class="project-detail-value" id="project-location">
                    -
                  </div>
                </div>

                <!-- Tipo -->
                <div class="project-detail-item">
                  <div class="project-detail-label">
                    <i class="fa fa-building"></i>Tipo
                  </div>
                  <div class="project-detail-value" id="project-type">-</div>
                </div>

                <!-- Área -->
                <div class="project-detail-item">
                  <div class="project-detail-label">
                    <i class="fa fa-expand"></i>Área
                  </div>
                  <div class="project-detail-value" id="project-area">-</div>
                </div>
              </div>

              <!-- Información Financiera - Destacado -->
              <div class="financial-highlight">
                <div class="row">
                  <div class="col-md-6">
                    <div class="project-detail-label">Inversión Total</div>
                    <div class="project-detail-value" id="project-invested">
                      -
                    </div>
                  </div>
                  <div class="col-md-6 mt-4 mt-md-0">
                    <div class="project-detail-label">Retorno Final</div>
                    <div class="project-detail-value" id="project-return">
                      -
                    </div>
                  </div>
                </div>
              </div>

              <!-- Métricas Financieras -->
              <div class="metrics-block">
                <h4 class="metrics-title">Métricas Financieras</h4>
                <div class="row">
                  <div class="col-md-6">
                    <div class="project-detail-item">
                      <div class="project-detail-label">
                        <i class="fa fa-line-chart"></i>Margen
                      </div>
                      <div class="project-detail-value" id="project-margin">
                        -
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="project-detail-item">
                      <div class="project-detail-label">
                        <i class="fa fa-percent"></i>TIR
                      </div>
                      <div class="project-detail-value" id="project-irr">-</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Botón de contacto -->
              <div class="contact-btn-container">
                <a href="contact.html" class="btn contact-btn">
                  <i class="fa fa-envelope mr-2"></i>Solicitar Más Información
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Footer -->
      <footer>
        <!-- Newsletter Section -->
        <div class="footer-top">
          <div class="container">
            <div class="row justify-content-between">
              <div class="col-lg-5 col-md-6 mb-md-0 mb-4">
                <div class="newsletter-container">
                  <h3 class="newsletter-title">
                    Mantente al día con las últimas oportunidades
                  </h3>
                  <p class="newsletter-description">
                    Suscríbete a nuestro boletín informativo para recibir
                    actualizaciones sobre nuevos proyectos y oportunidades.
                  </p>
                  <form class="newsletter-form">
                    <div class="input-group">
                      <input
                        class="form-control"
                        type="email"
                        placeholder="Introduce tu email"
                        aria-label="Email address"
                        required
                      />
                      <div class="input-group-append">
                        <button class="btn btn-subscribe" type="submit">
                          <span class="fw-600">ENVIAR</span>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-lg-6 col-md-6">
                <div class="row">
                  <div class="col-sm-6">
                    <div class="footer-links">
                      <h4 class="footer-links-title">Enlaces Rápidos</h4>
                      <ul class="footer-menu list-unstyled">
                        <li>
                          <a href="../index.html" class="footer-link">Inicio</a>
                        </li>
                        <li>
                          <a href="about.html" class="footer-link">Nosotros</a>
                        </li>
                        <li>
                          <a href="services.html" class="footer-link"
                            >Servicios</a
                          >
                        </li>
                        <li>
                          <a href="contact.html" class="footer-link"
                            >Contacto</a
                          >
                        </li>
                        <li>
                          <a href="past.html" class="footer-link"
                            >Proyectos Pasados</a
                          >
                        </li>
                        <li>
                          <a href="current.html" class="footer-link"
                            >Proyectos en Curso</a
                          >
                        </li>
                        <li>
                          <a href="privacy.html" class="footer-link"
                            >Política de Privacidad</a
                          >
                        </li>
                        <li>
                          <a href="legal.html" class="footer-link"
                            >Aviso Legal</a
                          >
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="footer-social">
                      <h4 class="social-title">Conecta con Nosotros</h4>
                      <div class="contact-info">
                        <div class="contact-item">
                          <i class="fa fa-linkedin"></i>
                          <a
                            href="https://www.linkedin.com/company/caretcap"
                            target="_blank"
                            rel="noopener"
                            class="contact-link"
                            >LinkedIn</a
                          >
                        </div>
                        <div class="contact-item">
                          <i class="fa fa-envelope"></i>
                          <a
                            href="mailto:info@caretcap.com"
                            class="contact-link"
                            >info@caretcap.com</a
                          >
                        </div>
                        <div class="contact-item">
                          <i class="fa fa-phone"></i>
                          <a href="tel:+34678919452" class="contact-link"
                            >+34 678 91 94 52</a
                          >
                        </div>
                        <div class="footer-eu-container">
                          <img
                            src="../assets/images/images/fondos.png"
                            alt="UE"
                            class="contact-img"
                            loading="lazy"
                          />
                          <p class="eu-funding-text">
                            Subvencionado y cofinanciado por el Servicio Público
                            de Empleo Estatal y la Unión Europea, dentro del
                            programa FSE+ de la Comunidad de Madrid en el marco
                            financiero 2021-2027.
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Copyright Section -->
        <div class="footer-bottom">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-md-4 text-md-left text-center mb-md-0 mb-3">
                <a href="../index.html" aria-label="Homepage">
                  <img
                    src="../assets/images/logo/logo2.png"
                    alt="Logo"
                    class="footer-logo"
                    loading="lazy"
                  />
                </a>
              </div>
              <div class="col-md-8 text-md-right text-center">
                <p class="copyright">
                  &copy; Copyright 2025 | Todos los derechos reservados
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </main>
    <!-- Idioma -->
    <div class="language-switcher">
      <button class="language-btn" id="language-toggle">ES</button>
      <div class="language-options" id="language-options">
        <a href="#" class="language-option active" data-lang="es">
          <span class="language-flag">🇪🇸</span> Español
        </a>
        <a href="#" class="language-option" data-lang="en">
          <span class="language-flag">🇬🇧</span> English
        </a>
        <a href="#" class="language-option" data-lang="zh">
          <span class="language-flag">🇨🇳</span> 中文
        </a>
      </div>
    </div>
    <!--  -->
    <!--    JavaScripts-->
    <!--    =============================================-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
    <script src="../assets/lib/jquery/dist/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
      integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
      crossorigin="anonymous"
    ></script>
    <script src="../assets/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../assets/lib/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="../assets/lib/gsap/src/minified/TweenMax.min.js"></script>
    <script src="../assets/lib/gsap/src/minified/plugins/ScrollToPlugin.min.js"></script>
    <script src="../assets/lib/CustomEase.min.js"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/zanimation.js"></script>
    <script src="../assets/js/inertia.js"></script>
    <script src="../assets/js/core.js"></script>
    <script src="../assets/js/main.js"></script>

    <!-- Script para cargar datos del proyecto -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Obtener ID del proyecto de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get("id");

        if (!projectId) {
          // Si no hay ID de proyecto, mostrar mensaje de error
          document.getElementById("loading-indicator").innerHTML = `
            <div class="alert alert-danger" role="alert">
              No se ha especificado un proyecto. Por favor, vuelva a la <a href="past.html">lista de proyectos</a>.
            </div>
          `;
          return;
        }

        // URL de la API
        const apiUrl = `https://caret-z446v.ondigitalocean.app/api/projects/${projectId}/`;

        // Cargar datos del proyecto
        fetch(apiUrl)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Error al cargar el proyecto");
            }
            return response.json();
          })
          .then((project) => {
            // Verificar que el proyecto sea de tipo "past"
            if (project.status !== "past") {
              document.getElementById("loading-indicator").innerHTML = `
                <div class="alert alert-warning" role="alert">
                  Este proyecto no está en la categoría de Proyectos Pasados. Puede verlo en <a href="currentproject.html?id=${project.id}">Proyectos en Curso</a>.
                </div>
              `;
              return;
            }

            // Actualizar título y breadcrumb
            document.getElementById("project-title").textContent = project.name;
            document.getElementById("breadcrumb-project-name").textContent =
              project.name;
            document.title = `Caret Capital | ${project.name}`;

            // Actualizar detalles del proyecto
            document.getElementById("detail-project-name").textContent =
              project.name;
            document.getElementById("project-location").textContent =
              project.location;
            document.getElementById("project-type").textContent = project.type;
            document.getElementById("project-area").textContent = `${parseFloat(
              project.area
            ).toLocaleString("es-ES", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })} m²`;

            // Formatear valores numéricos
            document.getElementById(
              "project-invested"
            ).textContent = `${parseFloat(project.invested).toLocaleString(
              "es-ES",
              { minimumFractionDigits: 2, maximumFractionDigits: 2 }
            )} €`;
            document.getElementById(
              "project-return"
            ).textContent = `${parseFloat(project.return_amount).toLocaleString(
              "es-ES",
              { minimumFractionDigits: 2, maximumFractionDigits: 2 }
            )} €`;
            document.getElementById(
              "project-margin"
            ).textContent = `${parseFloat(project.margin).toLocaleString(
              "es-ES",
              { minimumFractionDigits: 2, maximumFractionDigits: 2 }
            )} €`;
            document.getElementById("project-irr").textContent = `${parseFloat(
              project.irr
            ).toLocaleString("es-ES", {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            })}%`;

            // Establecer clase de estado
            const statusElement = document.getElementById("project-status");
            statusElement.classList.add("status-past");
            statusElement.textContent = "Finalizado";

            // Cargar imágenes en el carrusel
            const carouselInner = document.getElementById("carousel-items");
            const carouselIndicators = document.getElementById(
              "carousel-indicators"
            );
            let carouselItems = "";
            let indicators = "";

            // Añadir la imagen principal
            const mainImage = project.image
              ? project.image
              : "../assets/images/images/caret.png";
            carouselItems += `
              <div class="carousel-item active">
                <img src="${mainImage}" class="d-block w-100" alt="${project.name}">
              </div>
            `;

            // Añadir el primer indicador (activo)
            indicators += `<li data-target="#project-carousel" data-slide-to="0" class="active"></li>`;

            // Añadir imágenes adicionales
            if (
              project.additional_images &&
              project.additional_images.length > 0
            ) {
              project.additional_images.forEach((imgObj, index) => {
                carouselItems += `
                  <div class="carousel-item">
                    <img src="${imgObj.image}" class="d-block w-100" alt="${project.name} - Imagen adicional">
                  </div>
                `;

                // Añadir indicadores para imágenes adicionales
                indicators += `<li data-target="#project-carousel" data-slide-to="${
                  index + 1
                }"></li>`;
              });
            }

            carouselInner.innerHTML = carouselItems;
            carouselIndicators.innerHTML = indicators;

            // Mostrar el contenido y ocultar el indicador de carga
            document.getElementById("loading-indicator").style.display = "none";
            document.getElementById("project-content").style.display = "block";

            // Asegurar que las imágenes están cargadas antes de inicializar el carrusel
            const carouselImages = document.querySelectorAll(
              "#carousel-items img"
            );
            let imagesLoaded = 0;

            function checkAllImagesLoaded() {
              imagesLoaded++;
              if (imagesLoaded === carouselImages.length) {
                // Todas las imágenes están cargadas, ahora inicializamos el carrusel
                $("#project-carousel").carousel();

                // Asegurar que los botones de navegación funcionen
                const carouselElement =
                  document.getElementById("project-carousel");

                // Modificar los enlaces del carousel para evitar el desplazamiento
                const prevButton = document.querySelector(
                  ".carousel-control-prev"
                );
                const nextButton = document.querySelector(
                  ".carousel-control-next"
                );

                // Quitar los atributos href que causan el desplazamiento
                prevButton.removeAttribute("href");
                nextButton.removeAttribute("href");

                // Agregar listeners para los botones manualmente
                prevButton.addEventListener("click", function (e) {
                  e.preventDefault();
                  e.stopPropagation(); // Detener la propagación del evento
                  $("#project-carousel").carousel("prev");
                });

                nextButton.addEventListener("click", function (e) {
                  e.preventDefault();
                  e.stopPropagation(); // Detener la propagación del evento
                  $("#project-carousel").carousel("next");
                });

                // Reinicializar animaciones si es necesario
                if (typeof window.reInitializeComponents === "function") {
                  window.reInitializeComponents();
                }
              }
            }

            // Si no hay imágenes, inicializar de todos modos
            if (carouselImages.length === 0) {
              $("#project-carousel").carousel();
            } else {
              // Esperar a que cada imagen se cargue
              carouselImages.forEach((img) => {
                if (img.complete) {
                  checkAllImagesLoaded();
                } else {
                  img.addEventListener("load", checkAllImagesLoaded);
                  img.addEventListener("error", checkAllImagesLoaded); // Manejar errores de carga
                }
              });
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("loading-indicator").innerHTML = `
              <div class="alert alert-danger" role="alert">
                Error al cargar los detalles del proyecto. Por favor, intente nuevamente más tarde o vuelva a la <a href="past.html">lista de proyectos</a>.
              </div>
            `;
          });
      });
    </script>
  </body>
</html>
